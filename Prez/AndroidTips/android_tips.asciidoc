//
// Génération
//
// dzslides sans embarquer les ressources
// asciidoc <nomfichier>.asciidoc
//
// dzslides en embarquant les ressources
// asciidoc -a data-uri -a linkcss! <nomfichier>.asciidoc
= Bonnes pratiques du développement Android
Jean-François Garreau, SQLI 
v1.0
//:doctitle: Titre de la présentation, sans mise en avant de texte sous différentes formes.
:author: Jean-François Garreau, SQLI
:title: Bonnes pratiques du développement Android
:subtitle: Revue des bonnes pratiques et de quelques ui patterns
:description: Revue des bonnes pratiques et de quelques ui patterns
:copyright: Copyright 2013 SQLI
//:website: TBD
//:slidesurl: TBD
// à remplacer par le chemin relatif de notre path d'image
//:imagesdir: 
:backend: dzslides
:linkcss: true
:dzslides-style: sqli
:dzslides-transition: fade
:dzslides-highlight: github
:dzslides-autoplay: 0
// disable syntax highlighting unless turned on explicitly
:syntax: no-highlight
:sqli-custom-css: css/custom.css


//    _____   _   _   _______   _____     ____  
//   |_   _| | \ | | |__   __| |  __ \   / __ \ 
//     | |   |  \| |    | |    | |__) | | |  | |
//     | |   | . ` |    | |    |  _  /  | |  | |
//    _| |_  | |\  |    | |    | | \ \  | |__| |
//   |_____| |_| \_|    |_|    |_|  \_\  \____/ 
//                                              
//        


== Qui suis-je ?

===  Jean-François GARREAU

image::images/jf.png[role="float-left"]


* Consultant IT chez SQLI
 +
 +
* Développeur Android à mes heures perdues
 +
 +
* Un des membres fondateur du GDG Nantes
 +
 +

* Créateur de CineShowTime  image:images/cineshowtime.png[width="50"]
 +
 +

image::images/twitter-icon.png[width="50", role="float-left"]

@gdgnantes / @binomed / @uncle_bens1
 +
 +
 +

image::images/google-Plus-icon.png[width="50",role="float-left"]

http://gplus.to/jefBinomed



//     _____    ____    __  __   __  __              _____   _____    ______ 
//    / ____|  / __ \  |  \/  | |  \/  |     /\     |_   _| |  __ \  |  ____|
//   | (___   | |  | | | \  / | | \  / |    /  \      | |   | |__) | | |__   
//    \___ \  | |  | | | |\/| | | |\/| |   / /\ \     | |   |  _  /  |  __|  
//    ____) | | |__| | | |  | | | |  | |  / ____ \   _| |_  | | \ \  | |____ 
//   |_____/   \____/  |_|  |_| |_|  |_| /_/    \_\ |_____| |_|  \_\ |______|
//                                                                           
//      


== Sommaire


* Revoir son Java

* Ménager la mémoire

* Ui patterns

* Bonnes pratiques

* Les librairies
 


//         _             __      __           
//        | |     /\     \ \    / /     /\    
//        | |    /  \     \ \  / /     /  \   
//    _   | |   / /\ \     \ \/ /     / /\ \  
//   | |__| |  / ____ \     \  /     / ____ \ 
//    \____/  /_/    \_\     \/     /_/    \_\
//                                            
//                      

[role="intro fond_2"]
== Revoir son Java

image::images/LogoJava.png[role="icone"]

[NOTES]
====
Tout ce qu'on croit savoir est faux ;)
====


== Oublions le Java


image::images/forget_java.jpg[role="middle"]


== AutoBoxing et types primitifs

* AutoBoxing, c'est quoi ça ?

** C'est créer des objets à partir de types primitifs :
[{stepwise}]
--
[syntax="java"]
----
Integer result = 1;
for (int i = 0; i < 10; i++){
 result += i;
}
return result;
----

Reviens à : 


[syntax="java"]
----
Integer result = new Integer(1);
for (int i = 0; i < 10; i++){
 result = new Integer(i + result.intValue());
}
return result.intValue();
----
--

== Types primitifs

Il est donc préférable d'utiliser au maximum des types primitifs !

Attention cependant dans l'utilisation des types primitifs pour les nombres : 

[{middle}]
Les entiers sont en caches de -128 à 127

== SparseArray

Sorte de HashMap avec des clés "entiers" dont l'ojbectif est d'éviter l'auto boxing

[syntax="java"]
----
HashMap<Integer,String> map = new HashMap<Integer,String>();
map.put(550,"Echo");
map.put(551,"Echo");
map.get(550);
----

donne 

[{stepwise}]
--
[syntax="java"]
----
HashMap<Integer,String> map = new HashMap<Integer,String>();
map.put(new Integer(550),"Echo");
map.put(new Integer(551),"Echo");
map.get(new Integer(550));
----

avec les sparseArray : pas d'auotboxing ! 


[syntax="java"]
----
SparseArray<String> map = new SparseArray<String>();
map.put(550,"Echo");
map.put(551,"Echo");
map.get(550);
----
--

== Préférons les implémentations aux interfaces

* Avec Android, il est bon de ménager l'appareil dès qu'on le peut 

	Utilisation des implémentatins dans la déclaration plutôt que les interfaces.

[{stepwise}]
--
[syntax="java"]
----
List<String> list = new ArrayList<String>();
----

est à remplacer par 


[syntax="java"]
----
ArrayList<String> list = new ArrayList<String>();
----
--

[NOTES]
====
On fait ça pour ménager la compilation
====


//    __  __   ______   __  __    ____    _____   _____    ______ 
//   |  \/  | |  ____| |  \/  |  / __ \  |_   _| |  __ \  |  ____|
//   | \  / | | |__    | \  / | | |  | |   | |   | |__) | | |__   
//   | |\/| | |  __|   | |\/| | | |  | |   | |   |  _  /  |  __|  
//   | |  | | | |____  | |  | | | |__| |  _| |_  | | \ \  | |____ 
//   |_|  |_| |______| |_|  |_|  \____/  |_____| |_|  \_\ |______|
//                                                                
//  

[role="intro fond_2"]
== Ménageons la mémoire

=== Moins y en a mieux c'est

image::images/cofee_overload.jpg[role="icone"]


== Objectif : Instanciations minis ! 

=== Comment procédons nous pour faire le moins d'instanciations ?

* Nous sommes sur des téléphones, la ram n'est pas une ressources forcément très présente.

* Vous n'êtes pas la seule applications ! 

* Minimisons donc notre impact sur cette dernière.

** Variables statiques

** Réutilisation d'objets

** Gestion des chaines de caratères

** Layout allégé ! 

** Gestion de l'autoboxing (cf précédement)


== Préférons les variables statiques

=== Quand cela est possible bien entendu

* L'utilisation de variables statiques permet d'économiser des instanciations.

[syntax="java"]
----
public long doSomeStuff(int left, int top, int right, int bottom){
	return stuff(new Rect(left, top, right, bottom));
} 

public abstract long stuff(Rect rect);
----

[{stepwise}]
--
On peut faire mieux ! 

[syntax="java"]
----
private static final Rect rect = new Rect();

public long doSomeStuff(int left, int top, int right, int bottom){
	rect.set(left, top, right, bottom);
	return stuff(rect);
} 

public abstract long stuff(Rect rect);
----
--

== Réutilisons des objets !

[syntax="java"]
----
private static final int  MSG_ANIMATION_FRAME = 0xcafe;

public void sendMessage(Handler handler, Object userInfo){
	final Message message = new Message();
	message.what = MSG_ANIMATION_FRAME;
	message.obj = userInfo;

	handler.sendMessage(message);
} 

----


Peut être remplacé par 

[syntax="java"]
----
private static final int  MSG_ANIMATION_FRAME = 0xcafe;

public void sendMessage(Handler handler, Object userInfo){
	final Message message = Message.obtain();
	message.what = MSG_ANIMATION_FRAME;
	message.obj = userInfo;

	handler.sendMessage(message);
} 
----

* voici un article très intéressant sur la mise en place de ce design pattern : http://www.devahead.com/blog/2011/12/recycling-objects-in-android-with-an-object-pool-to-avoid-garbage-collection/?utm_source=%23AndroidDev+Weekly&utm_campaign=65486bb85d-NEWSLETTER&utm_medium=email[Design Pattern Object Pool]

== ViewHolder

=== Réutilisation de vue sur les listView

* pattern de réutilisabilité des vues 

PAS BIEN ! 

[syntax="java"]
----
public View getView(int position, View convertView, ViewGroup parent) {
    LayoutInflater inflater = (LayoutInflater) context
        .getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    View rowView = inflater.inflate(R.layout.rowlayout, parent, false);
    TextView textView = (TextView) rowView.findViewById(R.id.label);
    ImageView imageView = (ImageView) rowView.findViewById(R.id.icon);
    textView.setText(values[position]);
    // Change the icon for Windows and iPhone
    String s = values[position];
    if (s.startsWith("iPhone")) {
      imageView.setImageResource(R.drawable.no);
    } else {
      imageView.setImageResource(R.drawable.ok);
    }

    return rowView;
  }
----

== ViewHolder

=== Réutilisation de vue sur les listView

BIEN ! 

[syntax="java"]
----
public View getView(int position, View convertView, ViewGroup parent) {
	View rowView = null;

	if (convertView == null){
	    LayoutInflater inflater = (LayoutInflater) context
	        .getSystemService(Context.LAYOUT_INFLATER_SERVICE);
	    rowView = inflater.inflate(R.layout.rowlayout, parent, false);
	}else{
		rowView = convertView;
	}
    TextView textView = (TextView) rowView.findViewById(R.id.label);
    ImageView imageView = (ImageView) rowView.findViewById(R.id.icon);
    textView.setText(values[position]);
    // Change the icon for Windows and iPhone
    String s = values[position];
    if (s.startsWith("iPhone")) {
      imageView.setImageResource(R.drawable.no);
    } else {
      imageView.setImageResource(R.drawable.ok);
    }

    return rowView;
  }
----


== ViewHolder

=== Pourquoi donc ?

image::images/list_view_explain.jpg[{middle}, height="500px"]

== Gestion des chaines de caratères

* Préférez le StringBuffer aux concaténations de chaines !

* Pensez aussi à référencer 1 fois les chaines de caratères de vos vues si elles sont statiques. Utile pour le listView, ...



== Layout allégés

//    _    _   _____     _____               _______   _______   ______   _____    _   _ 
//   | |  | | |_   _|   |  __ \      /\     |__   __| |__   __| |  ____| |  __ \  | \ | |
//   | |  | |   | |     | |__) |    /  \       | |       | |    | |__    | |__) | |  \| |
//   | |  | |   | |     |  ___/    / /\ \      | |       | |    |  __|   |  _  /  | . ` |
//   | |__| |  _| |_    | |       / ____ \     | |       | |    | |____  | | \ \  | |\  |
//    \____/  |_____|   |_|      /_/    \_\    |_|       |_|    |______| |_|  \_\ |_| \_|
//                                                                                       
// 

[role="intro fond_2"]
== Ui patterns

image::images/ActionBar2.png[role="icone"]

== Action Bar

image::images/action_bar.jpg[{middle},height="400px"]

== DashBoard

image::images/dashboard.jpg[{middle},height="400px"]

== Sliding Menu

image::images/sliding_menu.png[{middle},height="400px"]

== PullToRefresh

image::images/Pulldowntorefresh.png[{middle},height="500px"]

== QuickActions

image::images/QuickActions.png[{middle}]

== ViewPager

image::images/Horizontalscrolling2.png[{middle}]


//    ____     ____    _   _   _   _   ______    _____     _____    _____               _______   _____    ____    _    _   ______    _____ 
//   |  _ \   / __ \  | \ | | | \ | | |  ____|  / ____|   |  __ \  |  __ \      /\     |__   __| |_   _|  / __ \  | |  | | |  ____|  / ____|
//   | |_) | | |  | | |  \| | |  \| | | |__    | (___     | |__) | | |__) |    /  \       | |      | |   | |  | | | |  | | | |__    | (___  
//   |  _ <  | |  | | | . ` | | . ` | |  __|    \___ \    |  ___/  |  _  /    / /\ \      | |      | |   | |  | | | |  | | |  __|    \___ \ 
//   | |_) | | |__| | | |\  | | |\  | | |____   ____) |   | |      | | \ \   / ____ \     | |     _| |_  | |__| | | |__| | | |____   ____) |
//   |____/   \____/  |_| \_| |_| \_| |______| |_____/    |_|      |_|  \_\ /_/    \_\    |_|    |_____|  \___\_\  \____/  |______| |_____/ 
//                                                                                                                                          
//     

[role="intro fond_2"]
== Bonnes Pratiques

image::images/yoda.jpg[role="icone"]

// Parler de la sauvegarde de la bande passante en utilisant les reciever
// Télécharger 1 seul fichier plutot que pls
// utilser du json
// gestion de BD
// AsynckTask
// Draw9Patch

//    _        _____   ____    _____               _____   _____    _____   ______    _____ 
//   | |      |_   _| |  _ \  |  __ \      /\     |_   _| |  __ \  |_   _| |  ____|  / ____|
//   | |        | |   | |_) | | |__) |    /  \      | |   | |__) |   | |   | |__    | (___  
//   | |        | |   |  _ <  |  _  /    / /\ \     | |   |  _  /    | |   |  __|    \___ \ 
//   | |____   _| |_  | |_) | | | \ \   / ____ \   _| |_  | | \ \   _| |_  | |____   ____) |
//   |______| |_____| |____/  |_|  \_\ /_/    \_\ |_____| |_|  \_\ |_____| |______| |_____/ 
//                                                                                          
//  

[role="intro fond_2"]
== Librairies

=== Quoi utiliser et pourquoi ?

image::images/android_lib.jpg[role="icone"]